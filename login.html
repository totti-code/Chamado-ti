<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Martree Support | Login</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header class="top">
  <div class="topInner">
    <div class="brand">
      <div class="logo"><img src="assets/logo.png" alt="Logo da Empresa"></div>
      <div>
        <h1>Martree Support</h1>
        <p class="muted">Acesso ao sistema</p>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="card" style="max-width:520px;margin:0 auto;">
    <h2>Entrar</h2>

    <label>Usuário</label>
    <input id="username" placeholder="Ex.: ismael" autocomplete="username" />

    <label style="margin-top:10px;">Senha</label>
    <input id="password" type="password" placeholder="••••••" autocomplete="current-password" />

    <div class="rowBtns">
      <button class="btn" id="btnLogin" type="button">Entrar</button>
    </div>

    <p class="msg" id="msg"></p>

    <p class="muted small" style="margin-top:10px;">
      Primeiro acesso: <b>admin</b> / <b>admin123</b> (troque depois no Admin).
    </p>
  </section>
</main>

<script type="module">
  import { login, getSession } from "./auth.js";

  const $ = (id) => document.getElementById(id);
  const msg = $("msg");

  // se já estiver logado, manda pro sistema
  const s = getSession();
  if (s) location.href = "index.html";

  function toast(text, ok=true){
    msg.style.color = ok ? "#2ee59d" : "#ff3b3b";
    msg.textContent = text;
    if (text) setTimeout(()=> msg.textContent="", 2500);
  }

  $("btnLogin").addEventListener("click", async () => {
    const username = $("username").value;
    const password = $("password").value;

    const res = await login(username, password);
    if (!res.ok) return toast(res.error, false);

    toast("Logado ✅");
    location.href = "index.html";
  });

  // enter para logar
  ["username","password"].forEach(id=>{
    $(id).addEventListener("keydown", (e)=>{
      if(e.key==="Enter") $("btnLogin").click();
    });
  });
</script>
</body>
</html>
